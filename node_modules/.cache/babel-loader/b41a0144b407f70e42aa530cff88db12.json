{"ast":null,"code":"var _jsxFileName = \"/Users/andreashellberg/Desktop/skolan/inla\\u0308mining2/uppgift2/src/containers/TheForm.jsx\";\nimport React, { useContext, useState } from \"react\";\nimport { useEffect } from \"react\";\nimport { useHistory } from \"react-router-dom\";\nimport { UserContext } from \"../UserContext\";\nimport Input from \"../components/Input\";\nimport SelectInput from \"../components/SelectInput\";\nimport FormKit from \"../data/FormKit\";\nimport UserKit from \"../data/UserKit\";\nimport styled from \"styled-components\";\nimport { StyledButton } from \"../pages/SignUpLogin\"; // when the form is rendered on the page, it is rendered\n//  with up to three props:\n// * type:   matches an array  in FormKit.js, the form will\n//   loop over the array and print out\n//   the corresponding inputs.\n// * customerEdit: if customerEdit is sent with the props,\n//   the form renders the Inputs from formKit.customer\n//   and sets the values of the inputs  to the values from the customerEdit object\n// * submit: when the form is submited, the switch\n//   in handleSubmit() checks the submit prop for the correct destination\n\nconst TheForm = ({\n  type,\n  customerEdit,\n  submit\n}) => {\n  const userKit = new UserKit();\n  const formKit = new FormKit();\n  const history = useHistory();\n  const [registerSuccess, setRegisterSuccess] = useState(false);\n  const [submitted, setSubmitted] = useState(false);\n  const [fieldValues, setFieldValues] = useState();\n  const [errorMessage, setErrorMessage] = useState({});\n  const {\n    listUpdate,\n    triggerListUpdate,\n    setLoggedIn\n  } = useContext(UserContext); //  to have controlled inputs, an initial value is set\n  //   by looping over the fields in formKit[type].\n  //  if a field has an option value, the value is set to option nr 1,\n  //  if it does not have an option value, the input will be\n  //  a regular input and it's initial value will be set to \"\"\n\n  useEffect(() => {\n    let form = formKit[type];\n    let initialFieldState = form.reduce((acc, cur) => {\n      return { ...acc,\n        [cur.name]: cur.options ? cur.options[0] : \"\"\n      };\n    }, {});\n    setFieldValues(initialFieldState);\n    setSubmitted(false);\n    setErrorMessage({});\n  }, [submitted]); // if customerEdit-object exists, the initial field-values are set\n  // directly from that object.\n\n  useEffect(() => {\n    customerEdit && setFieldValues(customerEdit);\n  }, []);\n\n  const handleChange = (name, value) => {\n    setFieldValues(prevState => {\n      return { ...prevState,\n        [name]: value\n      };\n    });\n  };\n\n  const login = () => {\n    userKit.login(fieldValues).then(res => res.json()).then(data => {\n      if (data.nonFieldErrors) {\n        setErrorMessage({\n          serverError: data.nonFieldErrors[0]\n        });\n      }\n\n      if (data.token) {\n        userKit.setSessionToken(data.token);\n        triggerListUpdate(!listUpdate);\n        history.push(\"/\");\n        setLoggedIn(true);\n      }\n    });\n  };\n\n  const handleSubmit = e => {\n    e.preventDefault();\n\n    if (formKit.validate(type, fieldValues, setErrorMessage)) {\n      switch (submit) {\n        case \"Register\":\n          userKit.register(fieldValues) // .then((res) => res.status === 201 && setRegisterSuccess(true))\n          .then(res => console.log(res.status));\n          break;\n\n        case \"Login\":\n          login();\n          break;\n\n        case \"Add customer\":\n          userKit.addCustomer(fieldValues).then(() => triggerListUpdate(!listUpdate));\n          break;\n\n        case \"Edit customer\":\n          userKit.updateCustomer(customerEdit.id, fieldValues).then(() => triggerListUpdate(!listUpdate)).then(history.push(\"/\"));\n          break;\n\n        default:\n          console.log(\"default\");\n      }\n\n      setSubmitted(true);\n    }\n  };\n\n  return /*#__PURE__*/React.createElement(StyledSection, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 119,\n      columnNumber: 5\n    }\n  }, registerSuccess && /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      color: \"green\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 9\n    }\n  }, \"An activatin mail has been sent to your mail\"), /*#__PURE__*/React.createElement(\"form\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 125,\n      columnNumber: 7\n    }\n  }, errorMessage.serverError && /*#__PURE__*/React.createElement(\"p\", {\n    style: {\n      color: \"red\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 127,\n      columnNumber: 11\n    }\n  }, \"Unable to login, please check email and password\"), fieldValues && formKit[type].map(field => {\n    if (field.input === \"input\") {\n      return /*#__PURE__*/React.createElement(Input, {\n        key: field.name,\n        required: field.required,\n        name: field.name,\n        label: field.name,\n        value: fieldValues[field.name],\n        handleChange: handleChange,\n        type: field.type,\n        error: errorMessage[field.name],\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 135,\n          columnNumber: 17\n        }\n      });\n    }\n\n    if (field.input === \"select\") {\n      return /*#__PURE__*/React.createElement(SelectInput, {\n        key: field.name,\n        name: field.name,\n        label: field.name,\n        value: fieldValues[field.name],\n        handleChange: handleChange,\n        options: field.options,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 149,\n          columnNumber: 17\n        }\n      });\n    }\n  }), /*#__PURE__*/React.createElement(SubmitButton, {\n    onClick: e => handleSubmit(e),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 160,\n      columnNumber: 9\n    }\n  }, submit)));\n};\n\nexport default TheForm;\nconst StyledSection = styled.section``;\nconst SubmitButton = styled(StyledButton)`\n  &:hover {\n  }\n`;","map":{"version":3,"sources":["/Users/andreashellberg/Desktop/skolan/inlaÌˆmining2/uppgift2/src/containers/TheForm.jsx"],"names":["React","useContext","useState","useEffect","useHistory","UserContext","Input","SelectInput","FormKit","UserKit","styled","StyledButton","TheForm","type","customerEdit","submit","userKit","formKit","history","registerSuccess","setRegisterSuccess","submitted","setSubmitted","fieldValues","setFieldValues","errorMessage","setErrorMessage","listUpdate","triggerListUpdate","setLoggedIn","form","initialFieldState","reduce","acc","cur","name","options","handleChange","value","prevState","login","then","res","json","data","nonFieldErrors","serverError","token","setSessionToken","push","handleSubmit","e","preventDefault","validate","register","console","log","status","addCustomer","updateCustomer","id","color","map","field","input","required","StyledSection","section","SubmitButton"],"mappings":"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","sourcesContent":["import React, { useContext, useState } from \"react\"\nimport { useEffect } from \"react\"\nimport { useHistory } from \"react-router-dom\"\nimport { UserContext } from \"../UserContext\"\nimport Input from \"../components/Input\"\nimport SelectInput from \"../components/SelectInput\"\nimport FormKit from \"../data/FormKit\"\nimport UserKit from \"../data/UserKit\"\nimport styled from \"styled-components\"\nimport { StyledButton } from \"../pages/SignUpLogin\"\n\n// when the form is rendered on the page, it is rendered\n//  with up to three props:\n// * type:   matches an array  in FormKit.js, the form will\n//   loop over the array and print out\n//   the corresponding inputs.\n// * customerEdit: if customerEdit is sent with the props,\n//   the form renders the Inputs from formKit.customer\n//   and sets the values of the inputs  to the values from the customerEdit object\n// * submit: when the form is submited, the switch\n//   in handleSubmit() checks the submit prop for the correct destination\nconst TheForm = ({ type, customerEdit, submit }) => {\n  const userKit = new UserKit()\n  const formKit = new FormKit()\n  const history = useHistory()\n  const [registerSuccess, setRegisterSuccess] = useState(false)\n  const [submitted, setSubmitted] = useState(false)\n  const [fieldValues, setFieldValues] = useState()\n  const [errorMessage, setErrorMessage] = useState({})\n\n  const { listUpdate, triggerListUpdate, setLoggedIn } = useContext(UserContext)\n\n  //  to have controlled inputs, an initial value is set\n  //   by looping over the fields in formKit[type].\n  //  if a field has an option value, the value is set to option nr 1,\n  //  if it does not have an option value, the input will be\n  //  a regular input and it's initial value will be set to \"\"\n  useEffect(() => {\n    let form = formKit[type]\n    let initialFieldState = form.reduce((acc, cur) => {\n      return {\n        ...acc,\n        [cur.name]: cur.options ? cur.options[0] : \"\",\n      }\n    }, {})\n    setFieldValues(initialFieldState)\n    setSubmitted(false)\n    setErrorMessage({})\n  }, [submitted])\n\n  // if customerEdit-object exists, the initial field-values are set\n  // directly from that object.\n  useEffect(() => {\n    customerEdit && setFieldValues(customerEdit)\n  }, [])\n\n  const handleChange = (name, value) => {\n    setFieldValues((prevState) => {\n      return {\n        ...prevState,\n        [name]: value,\n      }\n    })\n  }\n\n  const login = () => {\n    userKit\n      .login(fieldValues)\n      .then((res) => res.json())\n      .then((data) => {\n        if (data.nonFieldErrors) {\n          setErrorMessage({\n            serverError: data.nonFieldErrors[0],\n          })\n        }\n        if (data.token) {\n          userKit.setSessionToken(data.token)\n          triggerListUpdate(!listUpdate)\n          history.push(\"/\")\n          setLoggedIn(true)\n        }\n      })\n  }\n\n  const handleSubmit = (e) => {\n    e.preventDefault()\n    if (formKit.validate(type, fieldValues, setErrorMessage)) {\n      switch (submit) {\n        case \"Register\":\n          userKit\n            .register(fieldValues)\n            // .then((res) => res.status === 201 && setRegisterSuccess(true))\n            .then((res) => console.log(res.status))\n\n          break\n        case \"Login\":\n          login()\n          break\n        case \"Add customer\":\n          userKit\n            .addCustomer(fieldValues)\n            .then(() => triggerListUpdate(!listUpdate))\n          break\n        case \"Edit customer\":\n          userKit\n            .updateCustomer(customerEdit.id, fieldValues)\n            .then(() => triggerListUpdate(!listUpdate))\n            .then(history.push(\"/\"))\n          break\n        default:\n          console.log(\"default\")\n      }\n\n      setSubmitted(true)\n    }\n  }\n\n  return (\n    <StyledSection>\n      {registerSuccess && (\n        <div style={{ color: \"green\" }}>\n          An activatin mail has been sent to your mail\n        </div>\n      )}\n      <form>\n        {errorMessage.serverError && (\n          <p style={{ color: \"red\" }}>\n            Unable to login, please check email and password\n          </p>\n        )}\n        {fieldValues &&\n          formKit[type].map((field) => {\n            if (field.input === \"input\") {\n              return (\n                <Input\n                  key={field.name}\n                  required={field.required}\n                  name={field.name}\n                  label={field.name}\n                  value={fieldValues[field.name]}\n                  handleChange={handleChange}\n                  type={field.type}\n                  error={errorMessage[field.name]}\n                ></Input>\n              )\n            }\n            if (field.input === \"select\") {\n              return (\n                <SelectInput\n                  key={field.name}\n                  name={field.name}\n                  label={field.name}\n                  value={fieldValues[field.name]}\n                  handleChange={handleChange}\n                  options={field.options}\n                ></SelectInput>\n              )\n            }\n          })}\n        <SubmitButton onClick={(e) => handleSubmit(e)}>{submit}</SubmitButton>\n      </form>\n    </StyledSection>\n  )\n}\n\nexport default TheForm\n\nconst StyledSection = styled.section``\nconst SubmitButton = styled(StyledButton)`\n  &:hover {\n  }\n`\n"]},"metadata":{},"sourceType":"module"}